<html lang="fa" dir="rtl">
    <link rel="stylesheet" href="/WGDashboard-main/src/static/css/dashboard.css" />
    <link rel="stylesheet" href="/WGDashboard-main/src/static/css/bootstrap.min.css.map" />
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
    />

    {% with title="ورود به پنل"%} {% include "header.html"%} {% endwith %}
    <style>
        body {
            background-image: url(../static/img/background.jpg) !important;
            background-size: cover;
        }
    </style>
    <body>
        <div class="container-fluid login-container-fluid">
            <main role="main" class="container login-container">
                <div class="login-box">
                   
                    <span class="Under-img">
                        <p>به اکانت خود وارد شوید</p>
                        <img src="../static/img/user.png" class="login-logo" />
                    </span>
                    <form class="internal-box" action="/auth" method="post">
                      

                        <div class="alert alert-danger d-none" role="alert"></div>
                        <div class="form-group">
                            <input type="text" class="form-control mb-2" id="username" name="username" placeholder="username" dir="ltr" />
                        </div>
                        <div class="form-group">
                            <input type="password" class="form-control mb-2" id="password" name="password" placeholder="password" dir="ltr" />
                        </div>
                        <button type="submit" class="login-btn">
                            <span>ورود</span>
                            <i class="fa-solid fa-right-to-bracket"></i>
                        </button>
                    </form>
                </div>
            </main>
        </div>
        <small class="dashboard-version">Powerd by <a href="https://github.com/ipmartnetwork">ipmartnetwork</a></small>
    </body>
    <script>
        let loginButton = $('button[type="submit"]');
        loginButton.on("click", function (e) {
            e.preventDefault();
            let $password = $("#password");
            let $username = $("#username");
            let req = [$password, $username];
            let check = true;
            for (let i = 0; i < req.length; i++) {
                if ($(req[i]).val().length === 0) {
                    loginButton.html("ورود");
                    check = false;
                    $(req[i]).addClass("is-invalid");
                    break;
                }
            }
            if (check) {
                $(this).html("در حال ورود...").attr("disabled", "disabled");
                $.ajax({
                    url: "/auth",
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    data: JSON.stringify({
                        username: $("#username").val(),
                        password: $("#password").val(),
                    }),
                }).done(function (res) {
                    if (res.status === true) {
                        const urlParams = new URLSearchParams(window.location.search);
                        if (urlParams.get("redirect")) {
                            if (document.URL.substring(0, 5) == "http:") {
                                window.location.replace(`http://${urlParams.get("redirect")}`);
                            } else if (document.URL.substring(0, 5) == "https") {
                                window.location.replace(`https://${urlParams.get("redirect")}`);
                            }
                        } else {
                            window.location.replace("/");
                        }
                    } else {
                        $(".alert").html(res.msg).removeClass("d-none").fadeIn();
                        loginButton.html("ورود").removeAttr("disabled");
                        $("input[required]").addClass("is-invalid");
                    }
                });
            }
        });
    </script>
</html>
